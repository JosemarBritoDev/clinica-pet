{% extends "base.html" %}
{% load meus_filtros %}

{% block title %}
Listagem de Pet
{% endblock title %}

{% block content %}
<div class="container-fluid px-3 py-3">
  <section class="content">
    <div class="row">

      <!-- Perfil do Pet -->
      <div class="col-12 col-md-4 col-lg-3 mb-3">
        <div class="box box-primary">
          <div class="box-body box-profile">
            <h3 class="profile-username text-center">{{ pet.nome }}</h3>
            <p class="text-muted text-center">{{ pet.get_categoria_display }}</p>

            <ul class="list-group list-group-unbordered">
              <li class="list-group-item">
                <b>Nascimento</b> <span class="float-right">{{ pet.nascimento|date:"d/m/Y" }}</span>
              </li>
              <li class="list-group-item">
                <b>Cor</b> <span class="float-right">{{ pet.get_cor_display }}</span>
              </li>
            </ul>

            <br>
            <div class="row">
              <div class="col-lg-12">
                <a href="{% url 'base:cadastrar_consulta' pet.id %}" class="btn btn-primary btn-block">Cadastrar Consulta </a>
               <button type="button" class="btn btn-primary btn-block" onclick="window.history.back();">Voltar</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Histórico de Consultas -->
      <div class="col-12 col-md-8 col-lg-9">
        <div class="nav-tabs-custom">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#timeline" data-toggle="tab">Histórico</a></li>
          </ul>
          <div class="tab-content">
            <div class="active tab-pane" id="timeline">
              <ul class="timeline timeline-inverse">

                <!-- Data atual no topo da timeline -->
                <li class="time-label">
                  <span class="bg-green" id="dataAtual">Carregando...</span>
                </li>

                <!-- Loop das consultas -->
                {% for consulta in consultas %}
                <li>
                  <i class="fa fa-paw bg-blue"></i>
                  <div class="timeline-item">
                    <span class="time">
                      <i class="fa fa-calendar"></i> {{ consulta.data|date:"d/m/Y" }}
                    </span>
                    <h3 class="timeline-header">
                      {{ consulta.pet.nome }} realizou nova consulta
                    </h3>
                    <div class="timeline-body">
                      Esta consulta foi: {{ consulta.motivo_consulta }}
                    </div>
                    <div class="timeline-footer">
                      <a class="btn btn-primary btn-xs" href="{% url 'base:listar_consulta_id' consulta.id %}">
                        Visualizar Consulta
                      </a>
                    </div>
                  </div>
                </li>
                {% endfor %}

                <!-- Data da primeira consulta -->
                {% if consultas %}
                  {% with primeira=consultas|slice:"-1:" %}
                    <li class="time-label">
                      <span class="bg-red">
                        {{ primeira.0.data|date:"d/m/Y" }}
                      </span>
                    </li>
                  {% endwith %}
                {% endif %}

                <li><i class="fa fa-clock-o bg-gray"></i></li>

              </ul>
            </div>
          </div>
        </div>
      </div>

    </div>
  </section>
</div>

<!-- Script para exibir a data atual no formato "dd/mm/yyyy" -->
<script>
  function formatarDataNumerica(data) {
    const dia = String(data.getDate()).padStart(2, '0');
    const mes = String(data.getMonth() + 1).padStart(2, '0');
    const ano = data.getFullYear();
    return `${dia}/${mes}/${ano}`;
  }

  function atualizarData() {
    const hoje = new Date();
    const formatado = formatarDataNumerica(hoje);
    document.getElementById('dataAtual').textContent = formatado;
  }

  atualizarData();
</script>
{% endblock content %}